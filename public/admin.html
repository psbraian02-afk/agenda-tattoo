<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Richard Tattoo</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: #eee; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #222; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        h1 { border-bottom: 2px solid #b38e44; color: #b38e44; padding-bottom: 10px; text-align: center; }
        
        .booking-card { 
            background: #2d2d2d; 
            border-left: 5px solid #b38e44; 
            padding: 20px; 
            margin-bottom: 15px; 
            border-radius: 8px; 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start;
            gap: 15px;
        }

        .booking-info { flex: 1; }
        .booking-info h3 { margin: 0 0 10px 0; color: #fff; font-size: 1.4em; }
        .info { font-size: 0.95em; line-height: 1.6; color: #ccc; }
        .info strong { color: #b38e44; }

        .tattoo-preview { 
            width: 150px; 
            height: 150px; 
            object-fit: cover; 
            border-radius: 6px; 
            border: 2px solid #444;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .tattoo-preview:hover { transform: scale(1.05); }

        .btn-delete { 
            background: #e74c3c; 
            color: white; 
            border: none; 
            padding: 8px 12px; 
            cursor: pointer; 
            border-radius: 4px; 
            font-weight: bold;
            align-self: flex-start;
        }
        .btn-delete:hover { background: #c0392b; }

        .no-image { 
            width: 150px; height: 150px; 
            background: #3d3d3d; 
            display: flex; align-items: center; justify-content: center; 
            color: #777; font-size: 0.8em; border-radius: 6px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üíÄ Agenda Richard Tattoo</h1>
        <div id="lista-reservas">Cargando citas...</div>
    </div>

    <script>
        async function cargarReservas() {
            try {
                const res = await fetch('/api/bookings');
                const bookings = await res.json();
                const contenedor = document.getElementById('lista-reservas');
                
                if (bookings.length === 0) {
                    contenedor.innerHTML = "<p style='text-align:center;'>No hay turnos agendados a√∫n.</p>";
                    return;
                }

                // Ordenar por fecha (las m√°s recientes arriba)
                bookings.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                contenedor.innerHTML = bookings.map(b => `
                    <div class="booking-card">
                        <div class="booking-info">
                            <h3>${b.name} ${b.surname}</h3>
                            <div class="info">
                                <strong>üìÖ Fecha:</strong> ${b.date}<br>
                                <strong>‚è∞ Hora:</strong> ${b.start}:00hs<br>
                                <strong>üì± WhatsApp:</strong> <a href="https://wa.me/${b.phone}" target="_blank" style="color: #25d366; text-decoration: none;">${b.phone}</a><br>
                                <strong>üìç Zona:</strong> ${b.tattoo?.place || 'No especificada'}<br>
                                <strong>üìè Tama√±o:</strong> ${b.tattoo?.size || 'No especificado'}
                            </div>
                        </div>
                        
                        ${b.tattoo?.image 
                            ? `<img src="${b.tattoo.image}" class="tattoo-preview" onclick="window.open(this.src)" title="Click para ampliar">` 
                            : `<div class="no-image">Sin imagen</div>`}
                        
                        <button class="btn-delete" onclick="eliminarCita('${b.id}')">Eliminar</button>
                    </div>
                `).join('');
            } catch (err) {
                document.getElementById('lista-reservas').innerHTML = "Error cargando los datos.";
            }
        }

        async function eliminarCita(id) {
            if (confirm('¬øVas a borrar este turno permanentemente?')) {
                await fetch(`/api/bookings/${id}`, { method: 'DELETE' });
                cargarReservas();
            }
        }

        cargarReservas();
    </script>
</body>
</html>